{{- /*
Network Query Template - Extracts network data from the fixed schema.

The schema always has vnetwork and dvport tables. LEFT JOIN handles cases
where dvport is empty.
*/ -}}
SELECT
    n."Cluster" as "cluster",
    COALESCE(n."Switch", '') as "dvswitch",
    n."Network" as "name",
    'distributed' as "type",
    COALESCE(p."VLAN", '') as "vlanId",
    COUNT(*)::integer as "vmsCount"
FROM vnetwork n
LEFT JOIN dvport p ON n."Network" = p."Port"
WHERE n."Cluster" IS NOT NULL
GROUP BY n."Cluster", n."Switch", n."Network", p."VLAN";
